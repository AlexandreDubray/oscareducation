-extends "base.haml"

-block content
  %ol.breadcrumb
    %li
      %a{href: "{% url 'student_dashboard' %}"} Oscar
    %li.active
      Test
      =test_exercice.test

  -if not test_exercice.exercice
    %h1 Test de la compétence {{ test_exercice.skill.code }} mais nous n'avons pas encore de questions
    %hr

    %center
      %form{method: "POST"}
        -csrf_token
        %button.btn.btn-success.btn-lg{type: "submit", name: "value", value: "validate"}
          Marquer la compétence comme maitrisé

        %button.btn.btn-danger.btn-lg{type: "submit", name: "value", value: "unvalidate"}
          Marquer la compétence comme à apprendre

  -else
    .panel.panel-default
      .panel-heading
        Question n° {{ test_exercice.exercice.id }} sur
        =test_exercice.skill.code

      .panel-body
        -with content=test_exercice.get_content questions=test_exercice.get_questions
          -include "examinations/exercice_rendering.haml"

-block javascript
  :javascript
    $(function() {
      console.log("renderMathquil");
      renderMathquil($(".mathquill"), function(MQ, index, mq) {
          var input = $($(mq).parent().find("input")[0]);

          var mathquill = MQ.MathField(mq, {
                handlers: {
                    edit: function() {
                        input.val(mathquill.latex());
                        console.log(input.val());
                    }
                }
            });

          var keyboard = $($(mq).parent().children()[0]);

          return [mathquill, keyboard]
      });
    });
